<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
</head>
<body>
    <div id=text>
        <h2>Pirámide Poblacional de Puerto Rico</h2>
        <h3 id=year-subtitle> 1950</h3>
    </div>
        <div id="pchart01"></div>
        <div id="play-controls">
            <button id="play-pause-button" class="fa fa-play" title="play"> &#9654; </button>
            <input id="play-range" type="range" value="0" min="0" max="12" />
        </div>
</body>

<style>

    body {
        height:100%;
        width:100%;
    }

    #pchart01 {
        width:95%;
        height:80%;
        margin-left:2.5%;
    }


    h2 {
        margin-bottom:-12px;
        text-align:center;
        font-family: Helvetica, sans-serif
    }

    h3 {
        text-align:center;
        font-family: Helvetica, sans-serif;
        margin-bottom:-3px;
    }

    @import "https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css";
.loading {
    margin-top: 10em;
    text-align: center;
    color: gray;
}
#play-controls {
    min-width: 50%;
    max-width: 50%;
    margin-left:31%;
}
#play-controls * {
    display: inline-block;
    vertical-align: middle;
}
#play-pause-button {
    width: 30px;
    height: 30px;
    text-align: center;
    font-size: 15px;
    cursor: pointer;
    border: 1px solid silver;
    border-radius: 3px;
    background: #f8f8f8;
}
#play-range {
    width: 70%;
}
#play-output {
    font-family: Arial, Helvetica, sans-serif;
    margin-top:-600px
}
</style>

<script>
(function (H) {

var pendingRenders = [];

function isElementInViewport(el) {

    var rect = el.getBoundingClientRect();

    return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (
            window.innerHeight ||
            document.documentElement.clientHeight
        ) &&
        rect.right <= (
            window.innerWidth ||
            document.documentElement.clientWidth
        )
    );
}

H.wrap(H.Series.prototype, 'render', function deferRender(proceed) {
    var series = this,
        renderTo = this.chart.container.parentNode;

    // It is appeared, render it
    if (isElementInViewport(renderTo) || !series.options.animation) {
        proceed.call(series);

        // It is not appeared, halt rendering until appear
    } else {
        pendingRenders.push({
            element: renderTo,
            appear: function () {
                proceed.call(series);
            }
        });
    }
});

function recalculate() {
    pendingRenders.forEach(function (item) {
        if (isElementInViewport(item.element)) {
            item.appear();
            H.erase(pendingRenders, item);
        }
    });
}

if (window.addEventListener) {
    ['DOMContentLoaded', 'load', 'scroll', 'resize']
    .forEach(function (eventType) {
        addEventListener(eventType, recalculate, false);
    });
}

}(Highcharts));



Highcharts.setOptions({
lang: {
    thousandsSep: ','
},
chart: {

    backgroundColor: '#FFF',
},

legend: {
    itemStyle: {
        color: '#000'
    },
    itemHiddenStyle: {
        color: '#777'
    },
    itemHoverStyle: {
        color: '#777'
    }
},

title: {
    style: {
        color: '#22292F',
        fill: '#22292F',
        fontWeight: 'bold'
    }
},

subtitle: {
    style: {
        color: '#8795A1',
        fill: '#8795A1',
        fontWeight: 'bold'
    }
},

yAxis: {
    title: {
        style: {
            color: '#B8C2CC'
        }
    },


    labels: {
        style: {
            color: '#606F7B',
        }
    }
},


xAxis: {
    labels: {
        style: {
            color: '#606F7B',
        }
    }
},

exporting: {
        buttons: {
            contextButton: {
                x: -60,
            }
        }
    },

credits: {
    enabled: false
},

tooltip: {
    backgroundColor: "#FFF",
    borderColor: '#000',
    valueDecimals: 1,
    style: {
        opacity: 0.86
    },
    shared: true

},
 
plotOptions: {
    series: {
        lineWidth: 5,
        animation: {
            duration: 5000
        }
    },
},

});

var categories = [' ','0-4', '5-9', '10-14', '15-19',
'20-24', '25-29', '30-34', '35-39', '40-44',
'45-49', '50-54', '55-59', '60-64', '65-69',
'70-74', '75-79', '80-84', '85+', ' ', 'Segmento <br/> Poblacional'
];

var categoriesTotalArr1 = [
    ['<strong> 2,210,703 </strong>', '366,277', '318,368', '270,730', '220,452', '193,113', '158,136', '131,892', '133,242', '91,225', '75,728', '71,223', '46,418', '48,905', '32,763', '21,424', '11,757', '9,673', '93,77', ' ', 'Total por <br/> Segmento'],
    ['<strong> 2,349,565 </strong>', '354,402', '327,529', '321,207', '246,860', '171,665', '136,190', '126,729', '130,664', '107,353', '105,588', '75,208', '65,892', '58,071', '48,104', '31,504', '21,236', '10,124', '11,239', ' ', 'Total por <br/> Segmento'],
    ['<strong> 2,712,033 </strong>', '318,106', '338,254', '334,560', '291,326', '233,876', '182,638', '156,652', '145,123', '128,847', '121,966', '105,571', '96,453', '81,584', '66,383', '43,409', '28,366', '18,471', '20,448', ' ', 'Total por <br/> Segmento'],
    ['<strong> 3,196,520 </strong>', '340,652', '330,331', '338,291', '337,134', '272,430', '236,136', '229,762', '194,284', '165,652', '145,020', '129,786', '119,538', '104,935', '94,544', '65,480', '45,381', '24,245', '22,919', ' ', 'Total por <br/> Segmento'],
    ['<strong> 3,522,037 </strong>', '302,173', '316,473', '339,573', '326,717', '287,227', '270,562', '254,287', '236,509', '225,970', '193,984', '161,874', '140,952', '124,852', '112,718', '86,679', '67,822', '41,000', '32,665', ' ', 'Total por <br/> Segmento'],
    ['<strong> 3,808,610 </strong>', '295,406', '305,162', '305,800', '313,436', '301,191', '271,507', '262,825', '264,849', '250,814', '233,120', '229,916', '188,883', '160,564', '134,281', '106,670', '83,078', '53,402', '47,706', ' ', 'Total por <br/> Segmento'],
    ['<strong> 3,725,789 </strong>', '224,756', '240,004', '268,571', '284,259', '260,850', '244,159', '248,173', '241,270', '242,258', '247,986', '239,821', '223,607', '218,077', '175,411', '136,251', '100,740', '67,000', '62,596', ' ', 'Total por <br/> Segmento'],
    ['<strong> 3,678,736 </strong>', '213,462', '228,909', '259,845', '274,958', '264,094', '233,990', '243,564', '234,603', '237,766', '245,773', '238,220', '224,719', '215,590', '184,523', '139,946', '104,019', '69,339', '65,416', ' ', 'Total por <br/> Segmento'],
    ['<strong> 3,634,487 </strong>', '205,278', '222,321', '249,769', '267,879', '263,539', '227,123', '237,053', '230,729', '234,295', '242,319', '236,117', '225,588', '211,637', '190,952', '144,141', '106,795', '71,040', '67,912', ' ', 'Total por <br/> Segmento'],
    ['<strong> 3,593,079 </strong>', '197,173', '216,236', '239,184', '260,120', '262,420', '224,022', '229,793', '228,480', '230,649', '236,912', '236,012', '225,524', '208,784', '195,617', '148,941', '109,753', '72,738', '70,721', ' ', 'Total por <br/> Segmento'],
    ['<strong> 3,534,888 </strong>', '185,901', '208,914', '229,144', '249,966', '257,500', '222,722', '220,629', '224,179', '225,797', '230,070', '235,096', '224,570', '207,811', '197,813', '153,056', '113,118', '75,054', '73,548', ' ', 'Total por <br/> Segmento'],
    ['<strong> 3,474,182 </strong>', '174,875', '200,412', '217,747', '242,568', '248,792', '224,671', '208,957', '221,215', '219,817', '224,760', '232,541', '223,946', '206,919', '199,104', '157,583', '115,961', '78,393', '75,921', ' ', 'Total por <br/> Segmento'],
    ['<strong> 3,411,307 </strong>', '161,514', '188,163', '206,604', '234,298', '240,621', '225,720', '198,834', '215,572', '213,188', '219,701', '228,911', '222,473', '209,821', '199,167', '165,601', '119,272', '81,594', '80,253', ' ', 'Total por <br/> Segmento'],
]

var dataSequence = [
            { 
            name:'1950',
            data: [null,-185014,-161446,-138696,-108984,-91269,-76528,-66769,-67324,-47745,-39893,-36548,-24692,-25636,-16270,-10679,-5671,-4172,-3610, null, null]
            }, {
            name:'1960',
            data: [null,-179619,-165930,-162244,-122602,-79792,-61971,-58723,-61592,-53087,-53781,-39832,-34404,-29095,-24525,-16370,-10275,-4636,-4286, null, null]
            }, {
            name:'1970',
            data: [null,-161296,-171035,-169789,-143806,-108077,-84729,-73492,-68187,-61530,-59437,-53032,-49156,-40673,-32914,-21845,-13854,-7784,-9313, null, null]
            }, {
            name: '1980',
            data: [null,-173228,-168162,-172494,-168399,-129243,-110820,-107419,-91456,-78063,-68328,-61175,-57158,-50641,-45989,-31795,-21669,-11138,-9550, null, null]
            }, {
            name:'1990',
            data: [null,-153759,-161328,-172707,-165632,-140998,-129010,-119225,-110440,-105352,-91398,-75988,-65701,-57878,-52353,-40323,-31519,-18376,-13655, null, null]
            }, {
            name:'2000',
            data: [null,-151287,-156253,-155984,-159309,-149426,-133018,-126164,-124421,-116278,-107736,-106091,-87131,-74276,-60982,-47461,-35996,-22697,-19067, null, null]
            }, {
            name:'2010',
            data: [null,-115173,-123228,-137289,-144853,-130577,-118578,-119708,-115981,-114941,-115470,-110600,-102262,-100090,-80178,-61731,-43625,-27582,-23305, null, null]
            }, {
            name:'2011',
            data: [null,-109274,-117830,-133296,-140690,-132906,-114401,-117297,-112635,-113429,-114769,-110268,-102603,-98590,-84113,-63207,-45248,-28640,-24249, null, null]
            }, {
            name:'2012',
            data: [null,-105154,-114514,-128247,-136873,-132908,-111201,-113364,-110288,-111925,-113396,-109277,-102880,-96264,-86904,-64783,-46569,-29296,-25232, null, null]
            }, {
            name:'2013',
            data: [null,-101293,-111406,-123386,-133136,-132865,-110342,-110163,-108926,-110432,-111394,-109245,-102986,-94764,-88998,-66798,-47978,-29942,-26234, null, null]
            }, {
            name:'2014',
            data: [null,-95367,-107325,-118226,-128109,-130133,-110101,-105508,-106632,-107690,-108553,-108642,-102652,-94038,-89784,-68402,-49660,-30879,-27202, null, null]
            }, {
            name:'2015',
            data: [null,-89507,-102622,-112350,-124179,-125971,-111167,-99855,-104890,-104593,-106235,-107561,-102377,-93510,-89880,-70294,-50879,-32160,-28118, null, null]
            }, {
            name:'2016',
            data: [null,-82859,-95805,-106372,-119826,-121579,-111318,-94823,-101801,-101315,-104318,-105712,-102248,-95407,-89977,-74072,-52531,-33887,-29822, null, null]
            },
]

var dataSequence2 = [
            { 
            name:'1950',
            data: [null,181263,156922,132034,111468,101844,81608,65123,65918,43480,35835,34675,21726,23269,16493,10745,6086,5501,5767, null, null]
            }, {
            name:'1960',
            data: [null,174783,161599,158963,124258,91873,74219,68006,69072,54266,51807,35376,31488,28976,23579,15134,10961,5488,6953, null, null]
            }, {
            name:'1970',
            data: [null,156810,167219,164771,147520,125799,97909,83160,76936,67317,62529,52539,47297,40911,33469,21564,14512,10687,11135, null, null]
            }, {
            name: '1980',
            data: [null,167424,162169,165797,168735,143187,125316,122343,102828,87589,76692,68611,62380,54294,48555,33685,23712,13107,13369, null, null]
            }, {
            name:'1990',
            data: [null,148414,155145,166866,161085,146229,141552,135062,126069,120618,102586,85886,75251,66974,60365,46356,36303,22624,19010, null, null]
            }, {
            name:'2000',
            data: [null,144119,148909,149816,154127,151765,138489,136661,140428,134536,125384,123825,101752,86288,73299,59209,47082,30705,28639, null, null]
            }, {
            name:'2010',
            data: [null,109583,116776,131282,139406,130273,125581,128465,125289,127317,132516,129221,121345,117987,95233,74520,57115,39418,39291, null, null]
            }, {
            name:'2011',
            data: [null,104188,111079,126549,134268,131188,119589,126267,121968,124337,131004,127952,122116,117000,100410,76739,58771,40699,41167, null, null]
            }, {
            name:'2012',
            data: [null,100124,107807,121522,131006,130631,115922,123689,120441,122370,128923,126840,122708,115373,104048,79358,60226,41744,42680, null, null]
            }, {
            name:'2013',
            data: [null,95880,104830,115798,126984,129555,113680,119630,119554,120217,125518,126767,122538,114020,106619,82143,61775,42796,44487, null, null]
            }, {
            name:'2014',
            data: [null,90534,101589,110918,121857,127367,112621,115121,117547,118107,121517,126454,121918,113773,108029,84654,63458,44175,46346, null, null]
            }, {
            name:'2015',
            data: [null,85368,97790,105397,118389,122821,113504,109102,116325,115224,118525,124980,121569,113409,109224,87289,65082,46233,47803, null, null]
            }, {
            name:'2016',
            data: [null,78655,92358,100232,114472,119042,114402,104011,113771,111873,115383,123199,120225,114414,109190,91529,66741,47707,50431, null, null]
            },
]

   var chart = Highcharts.chart('pchart01', {
        chart: {
            type: 'bar',
        },
        title: {
            text: ' ',

        },
        xAxis: [{
            categories: categories,
            reversed: false,
            labels: {
                style: {
                    color: 'black',
                    step: 1
                }
            }
        }, { // Mirror axis in the right side
            opposite: true,
            reversed: false,
            categories: categoriesTotalArr1[0],
            linkedTo: 0,
            labels: {
                style: {
                    color: 'black',
                    step: 1
                }
            }
        }],
        yAxis: {
             max: 200000, // This prevents the data to shift right while in motion
             min: -200000,
            title: {
                text: null
            },
            labels: {
                style: {
                    color: 'black'
                },
                formatter: function () {
                    return Math.abs(this.value / 10000) + '%';
                }
            }
        },

        plotOptions: {
            // Spacing between data bars
            series: {
                stacking: 'normal',

            }
        },

        tooltip: {
            // This controls the hovering box when mouse is over data
            formatter: function () {
                return '<b>' + this.series.name + ' || Edades ' + this.point.category + '</b><br/>' +
                    '<b>Población: ' + Highcharts.numberFormat(Math.abs(this.y), 0) + '</b>';
            },
            shared:false
        },

        series: [{
            name: 'Masculino',
            color: '#008445',
            borderColor: '#008445', 
            data: dataSequence[0].data.slice(),
        }, {
            name: 'Femenino',
            color: '#FFD13F',
            borderColor: '#FFD13F',
            data: dataSequence2[0].data.slice()
        }],
    });

    function update(increment) {
        var input = $('#play-range')[0],
            output = $('#play-output')[0];

        if (increment) {
            input.value = parseInt(input.value) + increment;
        }
        chart.series[0].setData(dataSequence[input.value].data); // Increment dataset (updates chart)
        chart.series[1].setData(dataSequence2[input.value].data); // Increment dataset (updates chart)
        chart.update({
            xAxis: [{
            categories: categories,
            reversed: false,
            labels: {
                style: {
                    color: 'black',
                    step: 1
                }
            }
        }, { // Mirror axis in the right side
            opposite: true,
            reversed: false,
            categories: categoriesTotalArr1[input.value],
            linkedTo: 0,
            labels: {
                style: {
                    color: 'black',
                    step: 1
                }
            }
        }],
        }) // Increment dataset (updates xAxis Total)
        document.getElementById('year-subtitle').innerHTML= dataSequence[input.value].name
        if (input.value >= 12) { // Auto-pause
            pause($('#play-pause-button')[0]);
        }
    }

    /**
     * Play the timeline.
     */
    function play(button) {
        button.title = 'pause';
        button.className = 'fa fa-pause';
        button.innerHTML = '<strong>||<strong>';
        chart.sequenceTimer = setInterval ( function () {
            update(1);
        }, 3000);
    }
    
    /** 
     * Pause the timeline, either when the range is ended, or when clicking the pause button.
     * Pausing stops the timer and resets the button to play mode.
     */
    function pause(button) {
        button.title = 'play';
        button.className = 'fa fa-play';
        button.innerHTML = '&#9654;';
        clearTimeout(chart.sequenceTimer);
        chart.sequenceTimer = undefined;
    }

     /**
     * Toggle play and pause from the button
     */
     $('#play-pause-button').bind('click', function () {
        if (chart.sequenceTimer === undefined) {
            play(this);
        } else {
            pause(this);
        }
    });
    
    /**
     * Update the chart when the input is changed
     */
    $('#play-range').bind('input', function () {
        update();
    });

</script>
</html>